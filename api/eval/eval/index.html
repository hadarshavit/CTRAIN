
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../data_loaders/data_loaders/">
      
      
        <link rel="next" href="../../model_definitions/model_definitions/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.5">
    
    
      
        <title>eval - CTRAIN Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.8608ea7d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#CTRAIN.eval.eval" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="CTRAIN Documentation" class="md-header__button md-logo" aria-label="CTRAIN Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CTRAIN Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              eval
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="CTRAIN Documentation" class="md-nav__button md-logo" aria-label="CTRAIN Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    CTRAIN Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/certified_training/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Certified Training with CTRAIN
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/model_evaluation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Evaluation of models using CTRAIN
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/hyperparameter_optimisation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hyperparameter Optimisation using CTRAIN
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    attacks
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            attacks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../attacks/pgd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pgd
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    bound
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            bound
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bound/ibp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ibp
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bound/crown/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    crown
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bound/sabr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    sabr
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bound/taps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    taps
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    complete_verification
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            complete_verification
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../complete_verification/abCROWN/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    abCROWN
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data_loaders/data_loaders/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    data_loaders
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    eval
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    eval
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#CTRAIN.eval.eval" class="md-nav__link">
    <span class="md-ellipsis">
      eval
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#CTRAIN.eval.eval.eval_acc" class="md-nav__link">
    <span class="md-ellipsis">
      eval_acc
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#CTRAIN.eval.eval.eval_adaptive" class="md-nav__link">
    <span class="md-ellipsis">
      eval_adaptive
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#CTRAIN.eval.eval.eval_adversarial" class="md-nav__link">
    <span class="md-ellipsis">
      eval_adversarial
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#CTRAIN.eval.eval.eval_certified" class="md-nav__link">
    <span class="md-ellipsis">
      eval_certified
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#CTRAIN.eval.eval.eval_complete_abcrown" class="md-nav__link">
    <span class="md-ellipsis">
      eval_complete_abcrown
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#CTRAIN.eval.eval.eval_crown" class="md-nav__link">
    <span class="md-ellipsis">
      eval_crown
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#CTRAIN.eval.eval.eval_crown_ibp" class="md-nav__link">
    <span class="md-ellipsis">
      eval_crown_ibp
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#CTRAIN.eval.eval.eval_epoch" class="md-nav__link">
    <span class="md-ellipsis">
      eval_epoch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#CTRAIN.eval.eval.eval_ibp" class="md-nav__link">
    <span class="md-ellipsis">
      eval_ibp
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#CTRAIN.eval.eval.eval_model" class="md-nav__link">
    <span class="md-ellipsis">
      eval_model
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../model_definitions/model_definitions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    model_definitions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" >
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    model_wrappers
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            model_wrappers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../model_wrappers/crown_ibp_model_wrapper/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CROWN IBP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../model_wrappers/mtl_ibp_model_wrapper/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MTL IBP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../model_wrappers/sabr_model_wrapper/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SABR
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../model_wrappers/shi_ibp_model_wrapper/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SHI IBP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../model_wrappers/taps_model_wrapper/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TAPS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../model_wrappers/staps_model_wrapper/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    STAPS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../model_wrappers/ctrain_wrapper/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CTRAIN
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8" >
        
          
          <label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    train
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            train
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8_1" >
        
          
          <label class="md-nav__link" for="__nav_3_8_1" id="__nav_3_8_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    certified
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_8_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8_1">
            <span class="md-nav__icon md-icon"></span>
            certified
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../train/certified/ibp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IBP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../train/certified/crown_ibp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CROWN IBP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../train/certified/sabr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SABR
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../train/certified/taps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TAPS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../train/certified/staps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    STAPS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../train/certified/mtl_ibp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MTL-IBP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../train/certified/util/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    util
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../train/certified/eps_scheduler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    eps_scheduler
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8_1_9" >
        
          
          <label class="md-nav__link" for="__nav_3_8_1_9" id="__nav_3_8_1_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    initialisation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_8_1_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8_1_9">
            <span class="md-nav__icon md-icon"></span>
            initialisation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../train/certified/initialisation/shi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    shi
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8_1_10" >
        
          
          <label class="md-nav__link" for="__nav_3_8_1_10" id="__nav_3_8_1_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    regularisers
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_8_1_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8_1_10">
            <span class="md-nav__icon md-icon"></span>
            regularisers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../train/certified/regularisers/shi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    shi
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../train/certified/regularisers/l1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    l1
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8_1_11" >
        
          
          <label class="md-nav__link" for="__nav_3_8_1_11" id="__nav_3_8_1_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    losses
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_8_1_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8_1_11">
            <span class="md-nav__icon md-icon"></span>
            losses
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../train/certified/losses/convex_combinations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    convex_combinations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../train/certified/losses/crown_ibp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    crown_ibp
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../train/certified/losses/ibp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ibp
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../train/certified/losses/sabr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    sabr
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../train/certified/losses/taps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    taps
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../train/certified/losses/util/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    util
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../util/util/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    util
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#CTRAIN.eval.eval" class="md-nav__link">
    <span class="md-ellipsis">
      eval
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#CTRAIN.eval.eval.eval_acc" class="md-nav__link">
    <span class="md-ellipsis">
      eval_acc
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#CTRAIN.eval.eval.eval_adaptive" class="md-nav__link">
    <span class="md-ellipsis">
      eval_adaptive
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#CTRAIN.eval.eval.eval_adversarial" class="md-nav__link">
    <span class="md-ellipsis">
      eval_adversarial
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#CTRAIN.eval.eval.eval_certified" class="md-nav__link">
    <span class="md-ellipsis">
      eval_certified
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#CTRAIN.eval.eval.eval_complete_abcrown" class="md-nav__link">
    <span class="md-ellipsis">
      eval_complete_abcrown
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#CTRAIN.eval.eval.eval_crown" class="md-nav__link">
    <span class="md-ellipsis">
      eval_crown
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#CTRAIN.eval.eval.eval_crown_ibp" class="md-nav__link">
    <span class="md-ellipsis">
      eval_crown_ibp
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#CTRAIN.eval.eval.eval_epoch" class="md-nav__link">
    <span class="md-ellipsis">
      eval_epoch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#CTRAIN.eval.eval.eval_ibp" class="md-nav__link">
    <span class="md-ellipsis">
      eval_ibp
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#CTRAIN.eval.eval.eval_model" class="md-nav__link">
    <span class="md-ellipsis">
      eval_model
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>eval</h1>

<div class="doc doc-object doc-module">



<a id="CTRAIN.eval.eval"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="CTRAIN.eval.eval.eval_acc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">eval_acc</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">test_loader</span><span class="p">,</span> <span class="n">test_samples</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Evaluate the accuracy of a given model on a test dataset.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="torch.nn.Module">Module</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The model to be evaluated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_loader</code>
            </td>
            <td>
                  <code><span title="torch.utils.data.DataLoader">DataLoader</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataLoader for the test dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_samples</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of samples to test in order of the test loader. Default is np.inf (test all samples).</p>
              </div>
            </td>
            <td>
                  <code><span title="numpy.inf">inf</span></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The accuracy of the model on the test dataset.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>CTRAIN/eval/eval.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">eval_acc</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">test_loader</span><span class="p">,</span> <span class="n">test_samples</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate the accuracy of a given model on a test dataset.</span>

<span class="sd">    Args:</span>
<span class="sd">        model (torch.nn.Module): The model to be evaluated.</span>
<span class="sd">        test_loader (torch.utils.data.DataLoader): DataLoader for the test dataset.</span>
<span class="sd">        test_samples (int, optional): Number of samples to test in order of the test loader. Default is np.inf (test all samples).</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float): The accuracy of the model on the test dataset.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;mps&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">mps</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
    <span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">data</span><span class="p">,</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">test_loader</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">total</span> <span class="o">&gt;=</span> <span class="n">test_samples</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">batch_indices</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="p">),</span> <span class="n">test_samples</span> <span class="o">-</span> <span class="n">total</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="n">batch_indices</span><span class="p">]</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="p">[:</span><span class="n">batch_indices</span><span class="p">]</span>

            <span class="n">data</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span> <span class="n">target</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">predicted</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">total</span> <span class="o">+=</span> <span class="n">target</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">correct</span> <span class="o">+=</span> <span class="p">(</span><span class="n">predicted</span> <span class="o">==</span> <span class="n">target</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

    <span class="n">test_samples</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">test_samples</span><span class="p">,</span> <span class="n">total</span><span class="p">)</span>
    <span class="c1"># print(f&#39;Accuracy of the standard model on the first {test_samples} test images: {correct / test_samples:.4f}&#39;)</span>
    <span class="k">return</span> <span class="n">correct</span> <span class="o">/</span> <span class="n">test_samples</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="CTRAIN.eval.eval.eval_adaptive" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">eval_adaptive</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">data_loader</span><span class="p">,</span> <span class="n">n_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">test_samples</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;IBP&#39;</span><span class="p">,</span> <span class="s1">&#39;CROWN_IBP&#39;</span><span class="p">,</span> <span class="s1">&#39;CROWN&#39;</span><span class="p">])</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Evaluate the model in terms of certified accuracy in an adaptive method. This means, that all methods 
passed in the methods parameter are used to certify the samples in ascending order of computational complexity (IBP &lt; CROWN-IBP &lt; CROWN). 
If a sample is certified by one method, it is not evaluated by the following methods.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="auto_LiRPA.BoundedModule">BoundedModule</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The neural network model to be evaluated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The perturbation bound.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_loader</code>
            </td>
            <td>
                  <code><span title="torch.utils.data.DataLoader">DataLoader</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataLoader for the dataset to be evaluated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_classes</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of classes in the dataset. Default is 10.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_samples</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of samples to test in order of the test loader. Default is np.inf (test all samples).</p>
              </div>
            </td>
            <td>
                  <code><span title="numpy.inf">inf</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>device</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device to run the evaluation on. Default is 'cuda'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;cuda&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the number of certified samples, total number of images evaluated, and a tensor holding per-instance certification results.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>CTRAIN/eval/eval.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">eval_adaptive</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">data_loader</span><span class="p">,</span> <span class="n">n_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">test_samples</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;IBP&quot;</span><span class="p">,</span> <span class="s2">&quot;CROWN_IBP&quot;</span><span class="p">,</span> <span class="s2">&quot;CROWN&quot;</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate the model in terms of certified accuracy in an adaptive method. This means, that all methods </span>
<span class="sd">    passed in the methods parameter are used to certify the samples in ascending order of computational complexity (IBP &lt; CROWN-IBP &lt; CROWN). </span>
<span class="sd">    If a sample is certified by one method, it is not evaluated by the following methods.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        model (auto_LiRPA.BoundedModule): The neural network model to be evaluated.</span>
<span class="sd">        eps (float): The perturbation bound.</span>
<span class="sd">        data_loader (torch.utils.data.DataLoader): DataLoader for the dataset to be evaluated.</span>
<span class="sd">        n_classes (int, optional): Number of classes in the dataset. Default is 10.</span>
<span class="sd">        test_samples (int, optional): Number of samples to test in order of the test loader. Default is np.inf (test all samples).</span>
<span class="sd">        device (str, optional): Device to run the evaluation on. Default is &#39;cuda&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): A tuple containing the number of certified samples, total number of images evaluated, and a tensor holding per-instance certification results.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">methods</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">methods</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Please provide at least one bounding method!&quot;</span>

    <span class="n">certified</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="n">total_images</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">crown_data_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">data_loader</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">crown_data_loader</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">crown_data_loader</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">crown_data_loader</span><span class="o">.</span><span class="n">std</span> <span class="o">=</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">std</span>

    <span class="k">for</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">data_loader</span><span class="p">)):</span>
        <span class="n">certified_idx</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>

        <span class="n">ptb</span> <span class="o">=</span> <span class="n">PerturbationLpNorm</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">x_L</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">eps</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">max</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span> <span class="n">x_U</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">data</span> <span class="o">+</span> <span class="n">eps</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">max</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">))</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">targets</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span> <span class="n">targets</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">batch_idx</span> <span class="o">*</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">&gt;=</span> <span class="n">test_samples</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">total_images</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;IBP&quot;</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
            <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span> <span class="o">=</span> <span class="n">bound_ibp</span><span class="p">(</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                <span class="n">ptb</span><span class="o">=</span><span class="n">ptb</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                <span class="n">target</span><span class="o">=</span><span class="n">targets</span><span class="p">,</span>
                <span class="n">n_classes</span><span class="o">=</span><span class="n">n_classes</span><span class="p">,</span>
                <span class="n">reuse_input</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>
            <span class="n">certified_idx</span><span class="p">[(</span><span class="n">lb</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
        <span class="n">certified_idx</span> <span class="o">=</span> <span class="n">certified_idx</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
        <span class="n">ptb</span> <span class="o">=</span> <span class="n">PerturbationLpNorm</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">x_L</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="o">~</span><span class="n">certified_idx</span><span class="p">]</span> <span class="o">-</span> <span class="n">eps</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">max</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span> <span class="n">x_U</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="o">~</span><span class="n">certified_idx</span><span class="p">]</span> <span class="o">+</span> <span class="n">eps</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">max</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="n">certified_idx</span> <span class="o">=</span> <span class="n">certified_idx</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">certified_idx</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;CROWN-IBP&quot;</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>        
            <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span> <span class="o">=</span> <span class="n">bound_crown_ibp</span><span class="p">(</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                <span class="n">ptb</span><span class="o">=</span><span class="n">ptb</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="o">~</span><span class="n">certified_idx</span><span class="p">],</span>
                <span class="n">target</span><span class="o">=</span><span class="n">targets</span><span class="p">[</span><span class="o">~</span><span class="n">certified_idx</span><span class="p">],</span>
                <span class="n">n_classes</span><span class="o">=</span><span class="n">n_classes</span><span class="p">,</span>
                <span class="n">reuse_input</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>
            <span class="n">certified_idx</span><span class="p">[</span><span class="o">~</span><span class="n">certified_idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lb</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">certified</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">certified</span><span class="p">,</span> <span class="n">certified_idx</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;certified </span><span class="si">{</span><span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">certified</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">certified</span><span class="p">)</span><span class="si">}</span><span class="s2"> using IBP&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">crown_data_loader</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">batch_idx</span> <span class="o">&gt;=</span> <span class="n">test_samples</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">certified</span><span class="p">[</span><span class="n">batch_idx</span><span class="p">]</span> <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span><span class="s2">&quot;CROWN&quot;</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">):</span>
            <span class="k">continue</span>

        <span class="n">ptb</span> <span class="o">=</span> <span class="n">PerturbationLpNorm</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">x_L</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">eps</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">max</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span> <span class="n">x_U</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">data</span> <span class="o">+</span> <span class="n">eps</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">max</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">))</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">targets</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span> <span class="n">targets</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

        <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span> <span class="o">=</span> <span class="n">bound_crown</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
            <span class="n">ptb</span><span class="o">=</span><span class="n">ptb</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
            <span class="n">target</span><span class="o">=</span><span class="n">targets</span><span class="p">,</span>
            <span class="n">n_classes</span><span class="o">=</span><span class="n">n_classes</span><span class="p">,</span>
            <span class="n">reuse_input</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">instance_certified</span> <span class="o">=</span> <span class="p">(</span><span class="n">lb</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="n">certified</span><span class="p">[</span><span class="n">batch_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">instance_certified</span>

    <span class="k">if</span> <span class="n">test_samples</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
        <span class="n">certified</span> <span class="o">=</span> <span class="n">certified</span><span class="p">[:</span><span class="n">test_samples</span><span class="p">]</span>
    <span class="n">no_certified</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">certified</span><span class="p">)</span>            
    <span class="n">total_images</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">certified</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;CROWN&#39;</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;certified </span><span class="si">{</span><span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">certified</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">certified</span><span class="p">)</span><span class="si">}</span><span class="s2"> after using CROWN&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">no_certified</span><span class="p">,</span> <span class="n">total_images</span><span class="p">,</span> <span class="n">certified</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="CTRAIN.eval.eval.eval_adversarial" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">eval_adversarial</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data_loader</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">return_adv_indices</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">restarts</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">n_steps</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">early_stopping</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">n_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda&#39;</span><span class="p">,</span> <span class="n">test_samples</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Evaluate the adversarial robustness of a model using the PGD attack.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="torch.nn.Module">Module</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The model to evaluate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_loader</code>
            </td>
            <td>
                  <code><span title="torch.utils.data.DataLoader">DataLoader</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataLoader providing the dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The perturbation radius for the PGD attack.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_adv_indices</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to return the indices of adversarial samples. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>restarts</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of random restarts for the PGD attack. Default is 5.</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>step_size</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Step size for the PGD attack. Default is 0.1.</p>
              </div>
            </td>
            <td>
                  <code>0.1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_steps</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of steps for the PGD attack. Default is 40.</p>
              </div>
            </td>
            <td>
                  <code>40</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>early_stopping</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to stop early if an adversarial example is found. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_classes</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of classes in the dataset. Default is 10.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>device</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device to perform computations on. Default is 'cuda'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;cuda&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_samples</code>
            </td>
            <td>
                  <code>int or float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of samples to test. Default is np.inf.</p>
              </div>
            </td>
            <td>
                  <code><span title="numpy.inf">inf</span></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Adversarial accuracy of the model.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Indices of unsafe indices if return_adv_indices is True.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>CTRAIN/eval/eval.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">eval_adversarial</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data_loader</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">return_adv_indices</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">restarts</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">n_steps</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">early_stopping</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">n_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda&#39;</span><span class="p">,</span> <span class="n">test_samples</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate the adversarial robustness of a model using the PGD attack.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        model (torch.nn.Module): The model to evaluate.</span>
<span class="sd">        data_loader (torch.utils.data.DataLoader): DataLoader providing the dataset.</span>
<span class="sd">        eps (torch.Tensor): The perturbation radius for the PGD attack.</span>
<span class="sd">        return_adv_indices (bool, optional): Whether to return the indices of adversarial samples. Default is False.</span>
<span class="sd">        restarts (int, optional): Number of random restarts for the PGD attack. Default is 5.</span>
<span class="sd">        step_size (float, optional): Step size for the PGD attack. Default is 0.1.</span>
<span class="sd">        n_steps (int, optional): Number of steps for the PGD attack. Default is 40.</span>
<span class="sd">        early_stopping (bool, optional): Whether to stop early if an adversarial example is found. Default is False.</span>
<span class="sd">        n_classes (int, optional): Number of classes in the dataset. Default is 10.</span>
<span class="sd">        device (str, optional): Device to perform computations on. Default is &#39;cuda&#39;.</span>
<span class="sd">        test_samples (int or float, optional): Number of samples to test. Default is np.inf.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float): Adversarial accuracy of the model.</span>
<span class="sd">        (np.ndarray): Indices of unsafe indices if return_adv_indices is True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
    <span class="n">adv_preds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="n">data_min</span> <span class="o">=</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    <span class="n">data_max</span> <span class="o">=</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">data_loader</span><span class="p">)):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">test_samples</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="n">batch_indices</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">targets</span><span class="p">),</span> <span class="n">test_samples</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="n">batch_indices</span><span class="p">]</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="p">[:</span><span class="n">batch_indices</span><span class="p">]</span>

        <span class="n">data</span><span class="p">,</span> <span class="n">targets</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span> <span class="n">targets</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="n">eps</span> <span class="o">=</span> <span class="n">eps</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

        <span class="n">x_test_adv</span> <span class="o">=</span> <span class="n">pgd_attack</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
            <span class="n">target</span><span class="o">=</span><span class="n">targets</span><span class="p">,</span>
            <span class="n">x_L</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">eps</span><span class="p">,</span> <span class="n">data_min</span><span class="p">,</span> <span class="n">data_max</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span> 
            <span class="n">x_U</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">data</span> <span class="o">+</span> <span class="n">eps</span><span class="p">,</span> <span class="n">data_min</span><span class="p">,</span> <span class="n">data_max</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span>
            <span class="n">restarts</span><span class="o">=</span><span class="n">restarts</span><span class="p">,</span>
            <span class="n">step_size</span><span class="o">=</span><span class="n">step_size</span><span class="p">,</span>
            <span class="n">n_steps</span><span class="o">=</span><span class="n">n_steps</span><span class="p">,</span>
            <span class="n">early_stopping</span><span class="o">=</span><span class="n">early_stopping</span><span class="p">,</span>
            <span class="n">device</span><span class="o">=</span><span class="n">device</span>
        <span class="p">)</span>

        <span class="n">adv_predictions_batch</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">x_test_adv</span><span class="p">)</span>
        <span class="n">adv_predictions_batch</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">adv_predictions_batch</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">test_samples</span><span class="p">:</span>
            <span class="n">too_many_samples_no</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">targets</span><span class="p">))</span> <span class="o">%</span> <span class="n">test_samples</span>
            <span class="n">adv_predictions_batch</span> <span class="o">=</span> <span class="n">adv_predictions_batch</span><span class="p">[:</span><span class="o">-</span><span class="n">too_many_samples_no</span><span class="p">]</span>
            <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="p">[:</span><span class="o">-</span><span class="n">too_many_samples_no</span><span class="p">]</span>

        <span class="n">adv_preds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adv_preds</span><span class="p">,</span> <span class="n">adv_predictions_batch</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">targets</span><span class="o">.</span><span class="n">cpu</span><span class="p">())</span>

    <span class="n">test_samples</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">test_samples</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span>

    <span class="n">adv_accuracy</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">adv_preds</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">return_adv_indices</span><span class="p">:</span>
        <span class="n">adv_sample_found</span> <span class="o">=</span> <span class="n">labels</span> <span class="o">!=</span> <span class="n">adv_preds</span>
        <span class="k">return</span> <span class="n">adv_accuracy</span><span class="p">,</span> <span class="n">adv_sample_found</span>

    <span class="k">return</span> <span class="n">adv_accuracy</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="CTRAIN.eval.eval.eval_certified" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">eval_certified</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data_loader</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">n_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">test_samples</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;IBP&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Evaluate the certified robustness of a model using a given verification method.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="auto_LiRPA.BoundedModule">BoundedModule</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The neural network model to be evaluated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_loader</code>
            </td>
            <td>
                  <code><span title="torch.utils.data.DataLoader">DataLoader</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataLoader for the dataset to be evaluated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_classes</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of classes in the dataset. Default is 10.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Perturbation radius for certification.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_samples</code>
            </td>
            <td>
                  <code>int or float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of test samples to evaluate. Default is np.inf (all samples).</p>
              </div>
            </td>
            <td>
                  <code><span title="numpy.inf">inf</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>method</code>
            </td>
            <td>
                  <code>str or list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The certification method to use. Options are 'IBP', 'CROWN', 'CROWN-IBP', 'ADAPTIVE', 'COMPLETE', or a list of methods (which results in an ADAPTIVE evaluation using these methods). Default is 'IBP'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;IBP&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The certified accuracy of the model on the test examples for the given epsilon.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>CTRAIN/eval/eval.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">eval_certified</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data_loader</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">n_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">test_samples</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;IBP&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate the certified robustness of a model using a given verification method.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        model (auto_LiRPA.BoundedModule): The neural network model to be evaluated.</span>
<span class="sd">        data_loader (torch.utils.data.DataLoader): DataLoader for the dataset to be evaluated.</span>
<span class="sd">        n_classes (int, optional): Number of classes in the dataset. Default is 10.</span>
<span class="sd">        eps (float): Perturbation radius for certification.</span>
<span class="sd">        test_samples (int or float, optional): Number of test samples to evaluate. Default is np.inf (all samples).</span>
<span class="sd">        method (str or list, optional): The certification method to use. Options are &#39;IBP&#39;, &#39;CROWN&#39;, &#39;CROWN-IBP&#39;, &#39;ADAPTIVE&#39;, &#39;COMPLETE&#39;, or a list of methods (which results in an ADAPTIVE evaluation using these methods). Default is &#39;IBP&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float): The certified accuracy of the model on the test examples for the given epsilon.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;mps&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">mps</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
    <span class="n">certified</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">total_images</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;CROWN&quot;</span><span class="p">:</span>
        <span class="n">certified</span><span class="p">,</span> <span class="n">total_images</span> <span class="o">=</span> <span class="n">eval_crown</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">data_loader</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">,</span> <span class="n">test_samples</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;IBP&#39;</span><span class="p">:</span>
        <span class="n">certified</span><span class="p">,</span> <span class="n">total_images</span> <span class="o">=</span> <span class="n">eval_ibp</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">data_loader</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">,</span> <span class="n">test_samples</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;CROWN-IBP&#39;</span><span class="p">:</span>
        <span class="n">certified</span><span class="p">,</span> <span class="n">total_images</span> <span class="o">=</span> <span class="n">eval_crown_ibp</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">data_loader</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">,</span> <span class="n">test_samples</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;ADAPTIVE&#39;</span><span class="p">:</span>
        <span class="n">certified</span><span class="p">,</span> <span class="n">total_images</span><span class="p">,</span> <span class="n">cert_results</span> <span class="o">=</span> <span class="n">eval_adaptive</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">data_loader</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">,</span> <span class="n">test_samples</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">certified</span><span class="p">,</span> <span class="n">total_images</span><span class="p">,</span> <span class="n">cert_results</span> <span class="o">=</span> <span class="n">eval_adaptive</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">data_loader</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">,</span> <span class="n">test_samples</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;COMPLETE&#39;</span><span class="p">:</span>
        <span class="c1"># TODO: Infer input shape or pass it, pass timeout and no_cores!</span>
        <span class="n">eval_complete_abcrown</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">data_loader</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">),</span> <span class="n">test_samples</span><span class="o">=</span><span class="n">test_samples</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">no_cores</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
        <span class="n">certified</span><span class="p">,</span> <span class="n">total_images</span><span class="p">,</span> <span class="n">cert_results</span> <span class="o">=</span> <span class="n">eval_adaptive</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">data_loader</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">,</span> <span class="n">test_samples</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;UNKNOWN BOUNDING METHOD!&quot;</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">certified</span> <span class="o">/</span> <span class="n">total_images</span><span class="p">)</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="n">certified</span><span class="p">)</span> <span class="k">else</span> <span class="n">certified</span> <span class="o">/</span> <span class="n">total_images</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="CTRAIN.eval.eval.eval_complete_abcrown" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">eval_complete_abcrown</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">eps_std</span><span class="p">,</span> <span class="n">data_loader</span><span class="p">,</span> <span class="n">n_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">],</span> <span class="n">test_samples</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">no_cores</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span> <span class="n">abcrown_batch_size</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">separate_abcrown_process</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Evaluate the model using the complete ABCROWN method. Attention, this evaluation may be very costly!</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="auto_LiRPA.BoundedModule">BoundedModule</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The neural network model to be evaluated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps_std</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The standard deviation of the perturbation bound.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_loader</code>
            </td>
            <td>
                  <code><span title="torch.utils.data.DataLoader">DataLoader</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataLoader for the dataset to be evaluated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_classes</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of classes in the dataset. Default is 10.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>input_shape</code>
            </td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape of the input data. Default is [1, 28, 28].</p>
              </div>
            </td>
            <td>
                  <code>[1, 28, 28]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_samples</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of samples to test in order of the test loader. Default is np.inf (test all samples).</p>
              </div>
            </td>
            <td>
                  <code><span title="numpy.inf">inf</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>timeout</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Timeout for the ABCROWN evaluation in seconds. Default is 1000.</p>
              </div>
            </td>
            <td>
                  <code>1000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>no_cores</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of cores to use for MIP solving during the ABCROWN evaluation (if configured). Default is 28.</p>
              </div>
            </td>
            <td>
                  <code>28</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>abcrown_batch_size</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Batch size for the ABCROWN evaluation. Default is 512.</p>
              </div>
            </td>
            <td>
                  <code>512</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>separate_abcrown_process</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to run ABCROWN in a separate process. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>device</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device to run the evaluation on. Default is 'cuda'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;cuda&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the certified accuracy and the adversarial accuracy.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>CTRAIN/eval/eval.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">eval_complete_abcrown</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">eps_std</span><span class="p">,</span> <span class="n">data_loader</span><span class="p">,</span> <span class="n">n_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">],</span> <span class="n">test_samples</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">no_cores</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span> <span class="n">abcrown_batch_size</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">separate_abcrown_process</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate the model using the complete ABCROWN method. Attention, this evaluation may be very costly!</span>

<span class="sd">    Parameters:</span>
<span class="sd">        model (auto_LiRPA.BoundedModule): The neural network model to be evaluated.</span>
<span class="sd">        eps_std (float): The standard deviation of the perturbation bound.</span>
<span class="sd">        data_loader (torch.utils.data.DataLoader): DataLoader for the dataset to be evaluated.</span>
<span class="sd">        n_classes (int, optional): Number of classes in the dataset. Default is 10.</span>
<span class="sd">        input_shape (list, optional): Shape of the input data. Default is [1, 28, 28].</span>
<span class="sd">        test_samples (int, optional): Number of samples to test in order of the test loader. Default is np.inf (test all samples).</span>
<span class="sd">        timeout (int, optional): Timeout for the ABCROWN evaluation in seconds. Default is 1000.</span>
<span class="sd">        no_cores (int, optional): Number of cores to use for MIP solving during the ABCROWN evaluation (if configured). Default is 28.</span>
<span class="sd">        abcrown_batch_size (int, optional): Batch size for the ABCROWN evaluation. Default is 512.</span>
<span class="sd">        separate_abcrown_process (bool, optional): Whether to run ABCROWN in a separate process. Default is False.</span>
<span class="sd">        device (str, optional): Device to run the evaluation on. Default is &#39;cuda&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): A tuple containing the certified accuracy and the adversarial accuracy.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">no_certified</span><span class="p">,</span> <span class="n">total_images</span><span class="p">,</span> <span class="n">certified</span> <span class="o">=</span> <span class="n">eval_adaptive</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">eps_std</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">=</span><span class="n">data_loader</span><span class="p">,</span> <span class="n">n_classes</span><span class="o">=</span><span class="n">n_classes</span><span class="p">,</span> <span class="n">test_samples</span><span class="o">=</span><span class="n">test_samples</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="n">adv_acc</span><span class="p">,</span> <span class="n">adv_sample_found</span> <span class="o">=</span> <span class="n">eval_adversarial</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">=</span><span class="n">data_loader</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">eps_std</span><span class="p">,</span> <span class="n">n_classes</span><span class="o">=</span><span class="n">n_classes</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">test_samples</span><span class="o">=</span><span class="n">test_samples</span><span class="p">,</span> <span class="n">return_adv_indices</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">adv_sample_found</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">adv_sample_found</span><span class="p">)</span>
    <span class="n">total_images</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">batch_size</span> <span class="o">=</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">batch_size</span>

    <span class="n">std_config</span> <span class="o">=</span> <span class="n">get_abcrown_standard_conf</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span> <span class="n">no_cores</span><span class="o">=</span><span class="n">no_cores</span><span class="p">)</span>
    <span class="n">std_config</span><span class="p">[</span><span class="s1">&#39;solver&#39;</span><span class="p">][</span><span class="s1">&#39;batch_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">abcrown_batch_size</span>

    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;/tmp/abCROWN/&#39;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">export_onnx</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
        <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;/tmp/abCROWN_model.onnx&#39;</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
        <span class="n">input_shape</span><span class="o">=</span><span class="n">input_shape</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">data_loader</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">total_images</span> <span class="o">&gt;=</span> <span class="n">test_samples</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="n">batch_indices</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">targets</span><span class="p">),</span> <span class="n">test_samples</span> <span class="o">-</span> <span class="n">total_images</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="n">batch_indices</span><span class="p">]</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="p">[:</span><span class="n">batch_indices</span><span class="p">]</span>
        <span class="n">total_images</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BATCH </span><span class="si">{</span><span class="n">batch_idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">clean_pred</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">model</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">clean_correct</span> <span class="o">=</span> <span class="n">clean_pred</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span> <span class="o">==</span> <span class="n">targets</span>

        <span class="k">if</span> <span class="n">certified</span><span class="p">[</span><span class="n">batch_idx</span> <span class="o">*</span> <span class="n">batch_size</span><span class="p">:(</span><span class="n">batch_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">batch_size</span><span class="p">]</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">continue</span>

        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;/tmp/vnnlib_</span><span class="si">{</span><span class="n">batch_idx</span><span class="si">}</span><span class="s1">/&#39;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">vnnlib_batch</span> <span class="o">=</span> <span class="n">instances_to_vnnlib</span><span class="p">(</span>
            <span class="n">indices</span><span class="o">=</span><span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">targets</span><span class="p">))</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">certified</span><span class="p">[</span><span class="n">batch_idx</span> <span class="o">*</span> <span class="n">batch_size</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">adv_sample_found</span><span class="p">[</span><span class="n">batch_idx</span> <span class="o">*</span> <span class="n">batch_size</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="n">clean_correct</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span>
            <span class="n">data</span><span class="o">=</span><span class="p">[(</span><span class="n">img</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="k">for</span> <span class="n">img</span><span class="p">,</span> <span class="n">target</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">)],</span>
            <span class="n">vnnlib_path</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;/tmp/vnnlib_</span><span class="si">{</span><span class="n">batch_idx</span><span class="si">}</span><span class="s1">/&#39;</span><span class="p">,</span>
            <span class="n">experiment_name</span><span class="o">=</span><span class="s1">&#39;Experiment&#39;</span><span class="p">,</span>
            <span class="n">eps</span><span class="o">=</span><span class="n">eps_std</span> <span class="o">*</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">std</span><span class="p">,</span>
            <span class="n">eps_temp</span><span class="o">=</span><span class="n">eps_std</span><span class="p">,</span>
            <span class="n">data_min</span><span class="o">=</span><span class="n">data_loader</span><span class="o">.</span><span class="n">min</span><span class="p">,</span>
            <span class="n">data_max</span><span class="o">=</span><span class="n">data_loader</span><span class="o">.</span><span class="n">max</span><span class="p">,</span>
            <span class="n">no_classes</span><span class="o">=</span><span class="n">n_classes</span>
        <span class="p">)</span>
        <span class="n">vnnlib_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">batch_idx</span> <span class="o">*</span> <span class="n">batch_size</span> <span class="o">+</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">targets</span><span class="p">))</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">certified</span><span class="p">[</span><span class="n">batch_idx</span> <span class="o">*</span> <span class="n">batch_size</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">adv_sample_found</span><span class="p">[</span><span class="n">batch_idx</span> <span class="o">*</span> <span class="n">batch_size</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="n">clean_correct</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">vnnlib_indices</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">vnn_instance</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">vnnlib_indices</span><span class="p">,</span> <span class="n">vnnlib_batch</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">separate_abcrown_process</span><span class="p">:</span>
                <span class="n">running_time</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="n">limited_abcrown_eval</span><span class="p">(</span>
                    <span class="c1"># work_dir=&#39;/tmp/abCROWN&#39;,</span>
                    <span class="n">config</span><span class="o">=</span><span class="n">std_config</span><span class="p">,</span>
                    <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
                    <span class="n">instance</span><span class="o">=</span><span class="n">vnn_instance</span><span class="p">,</span>
                    <span class="n">vnnlib_path</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;/tmp/vnnlib_</span><span class="si">{</span><span class="n">batch_idx</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="n">model_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">model_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">model_onnx_path</span><span class="o">=</span><span class="s1">&#39;/tmp/abCROWN_model.onnx&#39;</span><span class="p">,</span>
                    <span class="n">input_shape</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span>
                    <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
                    <span class="n">no_cores</span><span class="o">=</span><span class="n">no_cores</span><span class="p">,</span>
                    <span class="n">par_factor</span><span class="o">=</span><span class="mi">1</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">running_time</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="n">abcrown_eval</span><span class="p">(</span>
                    <span class="c1"># work_dir=&#39;/tmp/abCROWN&#39;,</span>
                    <span class="n">config</span><span class="o">=</span><span class="n">std_config</span><span class="p">,</span>
                    <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
                    <span class="n">instance</span><span class="o">=</span><span class="n">vnn_instance</span><span class="p">,</span>
                    <span class="n">vnnlib_path</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;/tmp/vnnlib_</span><span class="si">{</span><span class="n">batch_idx</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="n">model_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">model_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">model_onnx_path</span><span class="o">=</span><span class="s1">&#39;/tmp/abCROWN_model.onnx&#39;</span><span class="p">,</span>
                    <span class="n">input_shape</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span>
                    <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
                    <span class="n">no_cores</span><span class="o">=</span><span class="n">no_cores</span><span class="p">,</span>
                    <span class="n">par_factor</span><span class="o">=</span><span class="mi">1</span>
                <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">running_time</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="s1">&#39;unsat&#39;</span><span class="p">:</span>
                <span class="n">no_certified</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">certified</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="s1">&#39;sat&#39;</span><span class="p">:</span>
                <span class="n">adv_sample_found</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/tmp/vnnlib_</span><span class="si">{</span><span class="n">batch_idx</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">test_samples</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
        <span class="n">certified</span> <span class="o">=</span> <span class="n">certified</span><span class="p">[:</span><span class="n">test_samples</span><span class="p">]</span>
    <span class="n">no_certified</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">certified</span><span class="p">)</span>    
    <span class="n">no_counterexample</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">adv_sample_found</span><span class="p">)</span>

    <span class="n">certified_acc</span> <span class="o">=</span> <span class="p">(</span><span class="n">no_certified</span> <span class="o">/</span> <span class="n">test_samples</span><span class="p">)</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="n">certified</span><span class="p">)</span> <span class="k">else</span> <span class="n">certified</span> <span class="o">/</span> <span class="n">test_samples</span>
    <span class="n">adv_acc</span> <span class="o">=</span> <span class="p">(</span><span class="n">test_samples</span>  <span class="o">-</span> <span class="n">no_counterexample</span><span class="p">)</span> <span class="o">/</span> <span class="n">test_samples</span>
    <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="n">adv_acc</span><span class="p">):</span>
        <span class="n">adv_acc</span> <span class="o">=</span> <span class="n">adv_acc</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">certified_acc</span><span class="p">,</span> <span class="n">adv_acc</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="CTRAIN.eval.eval.eval_crown" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">eval_crown</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">data_loader</span><span class="p">,</span> <span class="n">n_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">test_samples</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Evaluate the model using the CROWN method.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="auto_LiRPA.BoundedModule">BoundedModule</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The neural network model to be evaluated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The perturbation bound.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_loader</code>
            </td>
            <td>
                  <code><span title="torch.utils.data.DataLoader">DataLoader</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataLoader for the dataset to be evaluated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_classes</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of classes in the dataset. Default is 10.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_samples</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of samples to test in order of the test loader. Default is np.inf (test all samples).</p>
              </div>
            </td>
            <td>
                  <code><span title="numpy.inf">inf</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>device</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device to run the evaluation on. Default is 'cuda'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;cuda&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the number of certified samples and the total number of images evaluated.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>CTRAIN/eval/eval.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">eval_crown</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">data_loader</span><span class="p">,</span> <span class="n">n_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">test_samples</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate the model using the CROWN method.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        model (auto_LiRPA.BoundedModule): The neural network model to be evaluated.</span>
<span class="sd">        eps (float): The perturbation bound.</span>
<span class="sd">        data_loader (torch.utils.data.DataLoader): DataLoader for the dataset to be evaluated.</span>
<span class="sd">        n_classes (int, optional): Number of classes in the dataset. Default is 10.</span>
<span class="sd">        test_samples (int, optional): Number of samples to test in order of the test loader. Default is np.inf (test all samples).</span>
<span class="sd">        device (str, optional): Device to run the evaluation on. Default is &#39;cuda&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): A tuple containing the number of certified samples and the total number of images evaluated.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># IMPORTANT: Data Loader Batch Size must match Bounding Batch Size when using CROWN for evaluation (not important for IBP)</span>
    <span class="n">crown_data_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">data_loader</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">crown_data_loader</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">crown_data_loader</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">crown_data_loader</span><span class="o">.</span><span class="n">std</span> <span class="o">=</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">std</span>
    <span class="n">certified</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">total_images</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">crown_data_loader</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">total_images</span> <span class="o">&gt;=</span> <span class="n">test_samples</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">ptb</span> <span class="o">=</span> <span class="n">PerturbationLpNorm</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">x_L</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">eps</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">max</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span> <span class="n">x_U</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">data</span> <span class="o">+</span> <span class="n">eps</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">max</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">))</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">targets</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span> <span class="n">targets</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span> <span class="o">=</span> <span class="n">bound_crown</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
            <span class="n">ptb</span><span class="o">=</span><span class="n">ptb</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
            <span class="n">target</span><span class="o">=</span><span class="n">targets</span><span class="p">,</span>
            <span class="n">n_classes</span><span class="o">=</span><span class="n">n_classes</span><span class="p">,</span>
            <span class="n">reuse_input</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">no_certified</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">lb</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="c1"># no_falsified = torch.sum((ub &lt; 0).any(dim=1)).item()</span>
        <span class="n">certified</span> <span class="o">+=</span> <span class="n">no_certified</span>

        <span class="n">total_images</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">certified</span><span class="p">,</span> <span class="n">total_images</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="CTRAIN.eval.eval.eval_crown_ibp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">eval_crown_ibp</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">data_loader</span><span class="p">,</span> <span class="n">n_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">test_samples</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Evaluate the model using the CROWN-IBP method.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="auto_LiRPA.BoundedModule">BoundedModule</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The neural network model to be evaluated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The perturbation bound.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_loader</code>
            </td>
            <td>
                  <code><span title="torch.utils.data.DataLoader">DataLoader</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataLoader for the dataset to be evaluated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_classes</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of classes in the dataset. Default is 10.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_samples</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of samples to test in order of the test loader. Default is np.inf (test all samples).</p>
              </div>
            </td>
            <td>
                  <code><span title="numpy.inf">inf</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>device</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device to run the evaluation on. Default is 'cuda'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;cuda&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the number of certified samples and the total number of images evaluated.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>CTRAIN/eval/eval.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">eval_crown_ibp</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">data_loader</span><span class="p">,</span> <span class="n">n_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">test_samples</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate the model using the CROWN-IBP method.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        model (auto_LiRPA.BoundedModule): The neural network model to be evaluated.</span>
<span class="sd">        eps (float): The perturbation bound.</span>
<span class="sd">        data_loader (torch.utils.data.DataLoader): DataLoader for the dataset to be evaluated.</span>
<span class="sd">        n_classes (int, optional): Number of classes in the dataset. Default is 10.</span>
<span class="sd">        test_samples (int, optional): Number of samples to test in order of the test loader. Default is np.inf (test all samples).</span>
<span class="sd">        device (str, optional): Device to run the evaluation on. Default is &#39;cuda&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): A tuple containing the number of certified samples and the total number of images evaluated.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">certified</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">total_images</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">data_loader</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">total_images</span> <span class="o">&gt;=</span> <span class="n">test_samples</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">ptb</span> <span class="o">=</span> <span class="n">PerturbationLpNorm</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">x_L</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">eps</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">max</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span> <span class="n">x_U</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">data</span> <span class="o">+</span> <span class="n">eps</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">max</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">))</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">targets</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span> <span class="n">targets</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

        <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span> <span class="o">=</span> <span class="n">bound_crown_ibp</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
            <span class="n">ptb</span><span class="o">=</span><span class="n">ptb</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
            <span class="n">target</span><span class="o">=</span><span class="n">targets</span><span class="p">,</span>
            <span class="n">n_classes</span><span class="o">=</span><span class="n">n_classes</span><span class="p">,</span>
            <span class="n">reuse_input</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">no_certified</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">lb</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="c1"># no_falsified = torch.sum((ub &lt; 0).any(dim=1)).item()</span>
        <span class="n">certified</span> <span class="o">+=</span> <span class="n">no_certified</span>

        <span class="n">total_images</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">certified</span><span class="p">,</span> <span class="n">total_images</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="CTRAIN.eval.eval.eval_epoch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">eval_epoch</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data_loader</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda&#39;</span><span class="p">,</span> <span class="n">test_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">verification_method</span><span class="o">=</span><span class="s1">&#39;IBP&#39;</span><span class="p">,</span> <span class="n">results_path</span><span class="o">=</span><span class="s1">&#39;./results&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Evaluate the model during training. It computes the standard accuracy, certified accuracy, 
and adversarial accuracy of the model. The results are saved to a specified path in JSON format.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="torch.nn.Module">Module</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The model to be evaluated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_loader</code>
            </td>
            <td>
                  <code><span title="torch.utils.data.DataLoader">DataLoader</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataLoader for the dataset to evaluate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Perturbation radius used during evaluation of standard, certified and adversarial accuracy.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_classes</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of classes in the dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>device</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device to run the evaluation on. Default is 'cuda'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;cuda&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_samples</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of samples to use for evaluation. Default is 1000.</p>
              </div>
            </td>
            <td>
                  <code>1000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verification_method</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Method to use for certification. Default is "IBP".</p>
              </div>
            </td>
            <td>
                  <code>&#39;IBP&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>results_path</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the evaluation results. Default is "./results".</p>
              </div>
            </td>
            <td>
                  <code>&#39;./results&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing standard accuracy, certified accuracy, and adversarial accuracy.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>CTRAIN/eval/eval.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">eval_epoch</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data_loader</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda&#39;</span><span class="p">,</span> <span class="n">test_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">verification_method</span><span class="o">=</span><span class="s2">&quot;IBP&quot;</span><span class="p">,</span> <span class="n">results_path</span><span class="o">=</span><span class="s2">&quot;./results&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate the model during training. It computes the standard accuracy, certified accuracy, </span>
<span class="sd">    and adversarial accuracy of the model. The results are saved to a specified path in JSON format.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        model (torch.nn.Module): The model to be evaluated.</span>
<span class="sd">        data_loader (torch.utils.data.DataLoader): DataLoader for the dataset to evaluate.</span>
<span class="sd">        eps (torch.Tensor): Perturbation radius used during evaluation of standard, certified and adversarial accuracy.</span>
<span class="sd">        n_classes (int): Number of classes in the dataset.</span>
<span class="sd">        device (str, optional): Device to run the evaluation on. Default is &#39;cuda&#39;.</span>
<span class="sd">        test_samples (int, optional): Number of samples to use for evaluation. Default is 1000.</span>
<span class="sd">        verification_method (str, optional): Method to use for certification. Default is &quot;IBP&quot;.</span>
<span class="sd">        results_path (str, optional): Path to save the evaluation results. Default is &quot;./results&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing standard accuracy, certified accuracy, and adversarial accuracy.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">results_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
    <span class="n">std_acc</span> <span class="o">=</span> <span class="n">eval_acc</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">test_loader</span><span class="o">=</span><span class="n">data_loader</span><span class="p">,</span> <span class="n">test_samples</span><span class="o">=</span><span class="n">test_samples</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">eps</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="n">cert_acc</span> <span class="o">=</span> <span class="n">adv_acc</span> <span class="o">=</span> <span class="n">std_acc</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
            <span class="n">cert_acc</span> <span class="o">=</span> <span class="n">eval_certified</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">=</span><span class="n">data_loader</span><span class="p">,</span> <span class="n">n_classes</span><span class="o">=</span><span class="n">n_classes</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span> <span class="n">test_samples</span><span class="o">=</span><span class="n">test_samples</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">verification_method</span><span class="p">)</span>
            <span class="n">adv_acc</span> <span class="o">=</span> <span class="n">eval_adversarial</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">=</span><span class="n">data_loader</span><span class="p">,</span> <span class="n">n_classes</span><span class="o">=</span><span class="n">n_classes</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">test_samples</span><span class="o">=</span><span class="n">test_samples</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">results_path</span><span class="si">}</span><span class="s2">/stats.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;acc&quot;</span><span class="p">:</span> <span class="n">std_acc</span><span class="p">,</span> <span class="s2">&quot;cert_acc&quot;</span><span class="p">:</span> <span class="n">cert_acc</span><span class="p">,</span> <span class="s2">&quot;adv_acc&quot;</span><span class="p">:</span> <span class="n">adv_acc</span><span class="p">},</span> <span class="n">f</span>
        <span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">std_acc</span><span class="p">,</span> <span class="n">cert_acc</span><span class="p">,</span> <span class="n">adv_acc</span> 
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="CTRAIN.eval.eval.eval_ibp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">eval_ibp</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">data_loader</span><span class="p">,</span> <span class="n">n_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">test_samples</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Evaluate a model using Interval Bound Propagation (IBP) for certification.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="auto_LiRPA.BoundedModule">BoundedModule</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The neural network model to be evaluated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The l_inf perturbation bound for for certification.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_loader</code>
            </td>
            <td>
                  <code><span title="torch.utils.data.DataLoader">DataLoader</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataLoader providing the dataset to evaluate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_classes</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of classes in the classification task. Default is 10.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_samples</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of samples to test in order of the test loader. Default is np.inf (test all samples).</p>
              </div>
            </td>
            <td>
                  <code><span title="numpy.inf">inf</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>device</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device to run the evaluation on ('cuda', 'mps', 'cpu'). Default is 'cuda'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;cuda&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the number of certified samples and the total number of images evaluated.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>CTRAIN/eval/eval.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">eval_ibp</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">data_loader</span><span class="p">,</span> <span class="n">n_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">test_samples</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate a model using Interval Bound Propagation (IBP) for certification.</span>

<span class="sd">    Args:</span>
<span class="sd">        model (auto_LiRPA.BoundedModule): The neural network model to be evaluated.</span>
<span class="sd">        eps (float): The l_inf perturbation bound for for certification.</span>
<span class="sd">        data_loader (torch.utils.data.DataLoader): DataLoader providing the dataset to evaluate.</span>
<span class="sd">        n_classes (int, optional): Number of classes in the classification task. Default is 10.</span>
<span class="sd">        test_samples (int, optional): Number of samples to test in order of the test loader. Default is np.inf (test all samples).</span>
<span class="sd">        device (str, optional): Device to run the evaluation on (&#39;cuda&#39;, &#39;mps&#39;, &#39;cpu&#39;). Default is &#39;cuda&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): A tuple containing the number of certified samples and the total number of images evaluated.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">certified</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">total_images</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">data_loader</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">total_images</span> <span class="o">&gt;=</span> <span class="n">test_samples</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">ptb</span> <span class="o">=</span> <span class="n">PerturbationLpNorm</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">x_L</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">eps</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">max</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span> <span class="n">x_U</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">data</span> <span class="o">+</span> <span class="n">eps</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">max</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">))</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">targets</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span> <span class="n">targets</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

        <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span> <span class="o">=</span> <span class="n">bound_ibp</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
            <span class="n">ptb</span><span class="o">=</span><span class="n">ptb</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
            <span class="n">target</span><span class="o">=</span><span class="n">targets</span><span class="p">,</span>
            <span class="n">n_classes</span><span class="o">=</span><span class="n">n_classes</span><span class="p">,</span>
            <span class="n">reuse_input</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">no_certified</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">lb</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="c1"># no_falsified = torch.sum((ub &lt; 0).any(dim=1)).item()</span>
        <span class="n">certified</span> <span class="o">+=</span> <span class="n">no_certified</span>

        <span class="n">total_images</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">certified</span><span class="p">,</span> <span class="n">total_images</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="CTRAIN.eval.eval.eval_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">eval_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data_loader</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">n_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">test_samples</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ADAPTIVE&#39;</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Evaluate the model on standard, certified, and adversarial accuracy.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="auto_LiRPA.BoundedModule">BoundedModule</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The model to be evaluated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_loader</code>
            </td>
            <td>
                  <code><span title="torch.utils.data.DataLoader">DataLoader</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataLoader for the test dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_classes</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of classes in the dataset. Default is 10.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Perturbation size for adversarial and certified evaluation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_samples</code>
            </td>
            <td>
                  <code>int or float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of samples to test. Default is np.inf (all samples).</p>
              </div>
            </td>
            <td>
                  <code><span title="numpy.inf">inf</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>method</code>
            </td>
            <td>
                  <code>str or list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The certification method to use. Options are 'IBP', 'CROWN', 'CROWN-IBP', 'ADAPTIVE', 'COMPLETE', or a list of methods (which results in an ADAPTIVE evaluation using these methods). Default is 'IBP'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;ADAPTIVE&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>device</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device to perform adversarial evaluation on. Default is 'cuda'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;cuda&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing std_acc (float): Standard accuracy of the model, cert_acc (float): Certified accuracy of the model, adv_acc (float): Adversarial accuracy of the model.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>CTRAIN/eval/eval.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">eval_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data_loader</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">n_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">test_samples</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ADAPTIVE&#39;</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate the model on standard, certified, and adversarial accuracy.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        model (auto_LiRPA.BoundedModule): The model to be evaluated.</span>
<span class="sd">        data_loader (torch.utils.data.DataLoader): DataLoader for the test dataset.</span>
<span class="sd">        n_classes (int, optional): Number of classes in the dataset. Default is 10.</span>
<span class="sd">        eps (float, optional): Perturbation size for adversarial and certified evaluation.</span>
<span class="sd">        test_samples (int or float, optional): Number of samples to test. Default is np.inf (all samples).</span>
<span class="sd">        method (str or list, optional): The certification method to use. Options are &#39;IBP&#39;, &#39;CROWN&#39;, &#39;CROWN-IBP&#39;, &#39;ADAPTIVE&#39;, &#39;COMPLETE&#39;, or a list of methods (which results in an ADAPTIVE evaluation using these methods). Default is &#39;IBP&#39;.</span>
<span class="sd">        device (str, optional): Device to perform adversarial evaluation on. Default is &#39;cuda&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing std_acc (float): Standard accuracy of the model, cert_acc (float): Certified accuracy of the model, adv_acc (float): Adversarial accuracy of the model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">std_acc</span> <span class="o">=</span> <span class="n">eval_acc</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">test_loader</span><span class="o">=</span><span class="n">data_loader</span><span class="p">,</span> <span class="n">test_samples</span><span class="o">=</span><span class="n">test_samples</span><span class="p">)</span>
    <span class="n">cert_acc</span> <span class="o">=</span> <span class="n">eval_certified</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">=</span><span class="n">data_loader</span><span class="p">,</span> <span class="n">n_classes</span><span class="o">=</span><span class="n">n_classes</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span> <span class="n">test_samples</span><span class="o">=</span><span class="n">test_samples</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
    <span class="n">adv_acc</span> <span class="o">=</span> <span class="n">eval_adversarial</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">data_loader</span><span class="o">=</span><span class="n">data_loader</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span> <span class="n">n_classes</span><span class="o">=</span><span class="n">n_classes</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">test_samples</span><span class="o">=</span><span class="n">test_samples</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">std_acc</span><span class="p">,</span> <span class="n">cert_acc</span><span class="p">,</span> <span class="n">adv_acc</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
    
  </body>
</html>